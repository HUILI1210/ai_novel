/**
 * å‰§æœ¬åº“æœåŠ¡ - ç®¡ç†å‰§æœ¬æ¨¡æ¿çš„ä¿å­˜å’ŒåŠ è½½
 */

import { ScriptTemplate, CharacterConfig } from '../types';

const STORAGE_KEY = 'gala_script_library';

// é¢„è®¾å‰§æœ¬IDåˆ—è¡¨ï¼ˆä¸å¯åˆ é™¤ï¼‰
const PRESET_SCRIPT_IDS = ['default', 'preset_tsundere', 'preset_princess', 'preset_courtesan'];

// é¢„è®¾å‰§æœ¬1ï¼šå‚²å¨‡é’æ¢…ç«¹é©¬
const PRESET_TSUNDERE: ScriptTemplate = {
  id: 'preset_tsundere',
  name: 'ðŸ’• å‚²å¨‡é’æ¢…ç«¹é©¬',
  description: 'ç»å…¸æ ¡å›­æ‹çˆ±ï¼Œä»Žå°ä¸€èµ·é•¿å¤§çš„å¥¹å¯¹ä½ æœ‰ç€è¯´ä¸å‡ºå£çš„å¿ƒæ„',
  plotFramework: `ã€åºç« ï¼šæ˜¥æ—¥çš„é‚‚é€…ã€‘
æ¨±èŠ±é£žæ•£çš„å››æœˆåˆåŽï¼Œé«˜ä¸‰å­¦ç”Ÿé›¯æ›¦åƒå¾€å¸¸ä¸€æ ·ç‹¬è‡ªåœ¨å¤©å°å¹é£Žï¼Œäº«å—ç€éš¾å¾—çš„å®é™ã€‚ä½ å› ä¸ºèµ¶ä½œä¸šè€Œé”™è¿‡äº†æœ«ç­è½¦ï¼Œåªå¥½å›žåˆ°å­¦æ ¡å–ä¸œè¥¿ï¼Œå´åœ¨å¤©å°æ„å¤–å‘çŽ°äº†è¿™ä¸ªæ€»æ˜¯å¯¹ä½ å†·çœ¼ç›¸å¾…çš„é’æ¢…ç«¹é©¬ã€‚å¥¹çœ‹åˆ°ä½ æ—¶æ˜Žæ˜¾æ„£äº†ä¸€ä¸‹ï¼Œéšå³æ¢å¤äº†å†·æ·¡çš„è¡¨æƒ…ï¼š"ä½ åœ¨è¿™é‡Œåšä»€ä¹ˆï¼Ÿ"å¤•é˜³å°†å¥¹çš„é•¿å‘æŸ“æˆé‡‘è‰²ï¼Œå¾®é£Žå¹èµ·å¥¹çš„è£™æ‘†ï¼Œé‚£ä¸€åˆ»ä½ çªç„¶æ„è¯†åˆ°ï¼Œè¿™ä¸ªä»Žå°ä¸€èµ·é•¿å¤§çš„å¥³å­©ï¼Œä¼¼ä¹Žæœ‰ç€ä½ ä»Žæœªäº†è§£çš„ä¸€é¢ã€‚

ã€ç¬¬ä¸€ç« ï¼šè¯¯ä¼šçš„èŒèŠ½ã€‘
ç¬¬äºŒå¤©æ—©ä¸Šï¼Œé›¯æ›¦æ²¡æœ‰åƒå¾€å¸¸ä¸€æ ·ç­‰ä½ ä¸€èµ·ä¸Šå­¦ã€‚ä½ ç‹¬è‡ªèµ°åœ¨ç†Ÿæ‚‰çš„è·¯ä¸Šï¼Œå¿ƒä¸­èŽ«åå¤±è½ã€‚åˆ°äº†å­¦æ ¡ï¼Œä½ å‘çŽ°å¥¹æ­£åœ¨å’Œç­ä¸Šçš„è½¬æ ¡ç”Ÿè¯´è¯ï¼Œè„¸ä¸Šå¸¦ç€ä½ ä»Žæœªè§è¿‡çš„æ¸©æŸ”ç¬‘å®¹ã€‚å«‰å¦’å’Œä¸ç”˜åœ¨å¿ƒä¸­æ¶ŒåŠ¨ï¼Œä½ æ•…æ„åœ¨å¥¹é¢å‰è¡¨çŽ°å¾—æ¯«ä¸åœ¨æ„ã€‚åˆä¼‘æ—¶ï¼Œè½¬æ ¡ç”Ÿä¸»åŠ¨æ‰¾ä½ æ­è¯ï¼Œè¯´é›¯æ›¦ç»å¸¸å‘ä»–æèµ·ä½ ã€‚è¿™æœ¬æ˜¯å–„æ„çš„è¯ï¼Œå´è¢«ä½ è¯¯è§£ä¸ºç‚«è€€ã€‚æ”¾å­¦åŽï¼Œä½ çœ‹åˆ°é›¯æ›¦åœ¨å¤©å°ç­‰ä½ ï¼Œå´æ•…æ„ç»•é“è€Œè¡Œï¼Œç•™ä¸‹å¥¹åœ¨é£Žä¸­ç‹¬è‡ªç­‰å¾…ã€‚

ã€ç¬¬äºŒç« ï¼šå†²çªçš„çˆ†å‘ã€‘
è¿žç»­ä¸€å‘¨çš„å†·æˆ˜è®©ç­çº§æ°”æ°›å˜å¾—å°´å°¬ã€‚é›¯æ›¦å¼€å§‹åˆ»æ„é¿å¼€ä½ ï¼Œç”šè‡³å’Œè½¬æ ¡ç”Ÿèµ°å¾—æ›´è¿‘ã€‚æŸå¤©ä½“è‚²è¯¾ï¼Œä½ çœ‹åˆ°è½¬æ ¡ç”Ÿç»™é›¯æ›¦é€’æ°´ï¼Œå¥¹å¾®ç¬‘ç€æŽ¥è¿‡ï¼Œè¿™ä¸€å¹•å½»åº•ç‚¹ç‡ƒäº†ä½ çš„æ€’ç«ã€‚è¯¾åŽï¼Œä½ ç»ˆäºŽåœ¨èµ°å»Šæ‹¦ä½å¥¹ï¼š"ä¸ºä»€ä¹ˆèº²ç€æˆ‘ï¼Ÿ"å¥¹çœ¼ä¸­é—ªè¿‡å—ä¼¤ï¼Œå´å¼ºè£…å†·æ¼ ï¼š"æˆ‘ä»€ä¹ˆæ—¶å€™èº²ç€ä½ äº†ï¼Ÿæ˜¯ä½ å…ˆä¸ç†æˆ‘çš„ã€‚"äº‰åµå‡çº§ï¼Œä½ è„±å£è€Œå‡ºï¼š"ä½ æ˜¯ä¸æ˜¯è§‰å¾—è½¬æ ¡ç”Ÿæ¯”æˆ‘å¥½ï¼Ÿ"é›¯æ›¦è„¸è‰²çž¬é—´è‹ç™½ï¼Œæ³ªæ°´åœ¨çœ¼çœ¶æ‰“è½¬ï¼š"æ—¢ç„¶ä½ è¿™ä¹ˆæƒ³ï¼Œé‚£å°±ç®—äº†ã€‚"å¥¹è½¬èº«è·‘å¼€ï¼Œç•™ä¸‹æ‡Šæ‚”çš„ä½ ã€‚

ã€ç¬¬ä¸‰ç« ï¼šæ–‡åŒ–ç¥­çš„å¥‘æœºã€‘
ç­çº§å†³å®šåœ¨æ–‡åŒ–ç¥­ä¸¾åŠžå’–å•¡åŽ…æ´»åŠ¨ï¼Œè€å¸ˆæ°å¥½å°†ä½ å’Œé›¯æ›¦åˆ†åˆ°åŒä¸€ç»„è´Ÿè´£ç­–åˆ’ã€‚èµ·åˆä¸¤äººç›¸å¯¹æ— è¨€ï¼Œæ°”æ°›å°´å°¬ã€‚ä½†åœ¨è®¨è®ºèœå•æ—¶ï¼Œä½ å‘çŽ°å¥¹è¿˜è®°å¾—ä½ ä¸å–œæ¬¢çš„é£Ÿç‰©ï¼Œå¿ƒä¸­ä¸€åŠ¨ã€‚ä¸ºäº†æ´»åŠ¨æ•ˆæžœï¼Œä½ ä»¬ä¸å¾—ä¸æ”¾å­¦åŽç•™ä¸‹æ¥è®¨è®ºã€‚ä¸€æ¬¡å¶ç„¶çš„æœºä¼šï¼Œä½ çœ‹åˆ°å¥¹åœ¨ç©ºæ•™å®¤é‡Œç‹¬è‡ªç»ƒä¹ æœåŠ¡ç”¨è¯­ï¼Œé‚£ä»½è®¤çœŸè®©ä½ æ„ŸåŠ¨ã€‚ä½ ä¸»åŠ¨é“æ­‰ï¼š"ä¹‹å‰çš„äº‹ï¼Œå¯¹ä¸èµ·ã€‚"å¥¹åœä¸‹åŠ¨ä½œï¼ŒèƒŒå¯¹ç€ä½ ï¼š"...ç¬¨è›‹ï¼Œè°è¦ä½ é“æ­‰äº†ã€‚"å£°éŸ³é‡Œå¸¦ç€å“­è…”ã€‚

ã€ç¬¬å››ç« ï¼šç­¹å¤‡çš„æ—¥å¸¸ã€‘
æ–‡åŒ–ç¥­ç­¹å¤‡æœŸé—´ï¼Œä½ ä»¬é‡æ–°æ‰¾å›žäº†æ˜”æ—¥çš„é»˜å¥‘ã€‚ä¸€èµ·é‡‡è´­é£Ÿææ—¶ï¼Œå¥¹ç»†å¿ƒåœ°è®°ä¸‹æ¯ä¸ªäººçš„å–œå¥½ï¼›åˆ¶ä½œè£…é¥°å“æ—¶ï¼Œå¥¹ç¬¨æ‹™åœ°å´è®¤çœŸåœ°å¸®å¿™ï¼›æŽ’ç»ƒæœåŠ¡æµç¨‹æ—¶ï¼Œå¥¹ä¼šå·å·è„¸çº¢å´åšæŒå®Œæˆã€‚æŸä¸ªé›¨å¤©ï¼Œä½ ä»¬è¢«å›°åœ¨ä¾¿åˆ©åº—ï¼Œå¥¹ä¸»åŠ¨åˆ†äº«ä¼žï¼Œé›¨æ»´æ‰“åœ¨ä¼žé¢ä¸Šçš„å£°éŸ³æˆä¸ºæœ€åŠ¨å¬çš„èƒŒæ™¯éŸ³ä¹ã€‚ä½ å¼€å§‹æ³¨æ„åˆ°å¥¹çš„å°ç»†èŠ‚ï¼šç´§å¼ æ—¶ä¼šçŽ©å¼„å‘æ¢¢ï¼Œå¼€å¿ƒæ—¶çœ¼è§’ä¼šå¼¯æˆæœˆç‰™ï¼Œå®³ç¾žæ—¶ä¼šä¸‹æ„è¯†å’¬å˜´å”‡ã€‚

ã€ç¬¬äº”ç« ï¼šè½¬æ ¡ç”Ÿçš„çœŸç›¸ã€‘
æ–‡åŒ–ç¥­å‰ä¸€å¤©ï¼Œè½¬æ ¡ç”Ÿæ‰¾åˆ°ä½ ï¼Œå¦ç™½ä»–å³å°†è½¬å­¦ç¦»å¼€ã€‚"å…¶å®žæˆ‘ä¸€ç›´æƒ³å‘Šè¯‰ä½ ï¼Œé›¯æ›¦å¥¹...çœŸçš„å¾ˆåœ¨æ„ä½ ã€‚å¥¹ç»å¸¸å‘æˆ‘å’¨è¯¢å¦‚ä½•è¡¨è¾¾æ„Ÿæƒ…ï¼Œå› ä¸ºå¥¹å¤ªå®³ç¾žäº†ã€‚"åŽŸæ¥é›¯æ›¦æŽ¥è¿‘è½¬æ ¡ç”Ÿåªæ˜¯ä¸ºäº†å­¦ä¹ å¦‚ä½•ä¸Žä½ ç›¸å¤„ã€‚ä½ éœ‡æƒŠåœ°æƒ³èµ·è¿™æ®µæ—¶é—´çš„ç§ç§è¯¯ä¼šï¼Œå¿ƒä¸­å……æ»¡æ„§ç–šã€‚è½¬æ ¡ç”Ÿç»§ç»­è¯´ï¼š"å¥¹ä¸ºä½ åšäº†å¾ˆå¤šäº‹ï¼Œæ¯”å¦‚æ¯å¤©æ—©ä¸Šéƒ½ä¼šåœ¨ä½ å®¶æ¥¼ä¸‹ç­‰ä½ ï¼Œåªæ˜¯ä½ æœ€è¿‘å‡ºé—¨å¤ªæ—©äº†ã€‚"

ã€ç¬¬å…­ç« ï¼šæ–‡åŒ–ç¥­å½“å¤©ã€‘
æ–‡åŒ–ç¥­å½“å¤©ï¼Œå’–å•¡åŽ…æ„å¤–å—æ¬¢è¿Žã€‚é›¯æ›¦ç©¿ç€å¥³ä»†è£…ï¼Œç´§å¼ å¾—æ‰‹å¿™è„šä¹±ï¼Œå´ä¾ç„¶åŠªåŠ›ä¿æŒå¾®ç¬‘ã€‚ä½ çœ‹åˆ°å¥¹è¢«å®¢äººåˆéš¾æ—¶ï¼Œæ¯«ä¸çŠ¹è±«åœ°ç«™å‡ºæ¥è§£å›´ã€‚åˆä¼‘æ—¶ï¼Œä½ ä»¬åœ¨å¤©å°åƒä¾¿å½“ï¼Œå¥¹äº²æ‰‹åšçš„é¥­èœè®©ä½ æ„ŸåŠ¨ï¼š"è°¢è°¢ä½ ä¸€ç›´ä»¥æ¥çš„åŒ…å®¹ã€‚"å¥¹è„¸çº¢ç€ä½Žå¤´ï¼š"...åªæ˜¯ä¸æƒ³è¾“ç»™å…¶ä»–ç­çº§è€Œå·²ã€‚"å¤•é˜³ä¸‹ï¼Œå¥¹çš„ä¾§è„¸æ ¼å¤–ç¾Žä¸½ï¼Œä½ å¿ä¸ä½æƒ³å‘Šè¯‰å¥¹çœŸç›¸ã€‚

ã€ç¬¬ä¸ƒç« ï¼šçƒŸç«çš„å‘Šç™½ã€‘
æ–‡åŒ–ç¥­ç»“æŸåŽçš„å¤œæ™šï¼Œå­¦æ ¡é™„è¿‘æœ‰çƒŸç«å¤§ä¼šã€‚é›¯æ›¦çŠ¹è±«åœ°é—®ä½ è¦ä¸è¦ä¸€èµ·åŽ»ï¼Œä½ æ¬£ç„¶ç­”åº”ã€‚çƒŸç«ç»½æ”¾çš„çž¬é—´ï¼Œä½ ç»ˆäºŽé¼“èµ·å‹‡æ°”ï¼š"å…¶å®žæˆ‘ä¸€ç›´å–œæ¬¢ä½ ã€‚"å¥¹æ„£ä½äº†ï¼ŒçƒŸç«çš„å…‰èŠ’æ˜ åœ¨å¥¹å«æ³ªçš„çœ¼ä¸­ï¼š"ç¬¨è›‹...ä¸ºä»€ä¹ˆçŽ°åœ¨æ‰è¯´ã€‚"å¥¹é åœ¨ä½ è‚©ä¸Šï¼Œå£°éŸ³é¢¤æŠ–ï¼š"æˆ‘ç­‰è¿™å¥è¯ç­‰äº†å¥½ä¹…ã€‚"çƒŸç«ä¸‹ï¼Œä½ ä»¬ç›¸æ‹¥è€Œå»ï¼Œå¤šå¹´çš„æš—æ‹ç»ˆäºŽæœ‰äº†ç»“æžœã€‚

ã€ç¬¬å…«ç« ï¼šæ–°çš„å¼€å§‹ã€‘
ç¬¬äºŒå¤©æ—©ä¸Šï¼Œé›¯æ›¦åƒå¾€å¸¸ä¸€æ ·åœ¨ä½ å®¶æ¥¼ä¸‹ç­‰ä½ ï¼Œä½†è¿™æ¬¡å¥¹çš„è„¸ä¸Šå¸¦ç€ç”œèœœçš„ç¬‘å®¹ã€‚ä¸€èµ·ä¸Šå­¦çš„è·¯ä¸Šï¼Œä½ ä»¬ä¸å†æ˜¯æ²‰é»˜çš„äºŒäººï¼Œè€Œæ˜¯æœ‰è¯´æœ‰ç¬‘çš„æ‹äººã€‚åŒå­¦ä»¬çœ‹åˆ°ä½ ä»¬çš„å˜åŒ–ï¼Œçº·çº·èµ·å“„ï¼Œé›¯æ›¦è™½ç„¶å®³ç¾žå´ç´§ç´§æ¡ä½ä½ çš„æ‰‹ã€‚æ”¾å­¦åŽçš„å¤©å°æˆä¸ºä½ ä»¬çš„ç§˜å¯†åŸºåœ°ï¼Œçœ‹å¤•é˜³ã€èŠæ¢¦æƒ³ï¼Œè§„åˆ’ç€å³å°†åˆ°æ¥çš„é«˜è€ƒå’Œæœªæ¥ã€‚

ã€ç»ˆç« ï¼šæ°¸è¿œçš„çº¦å®šã€‘
æ¨±èŠ±å†æ¬¡é£žæ•£çš„å­£èŠ‚ï¼Œä½ ä»¬å³å°†æ¯•ä¸šã€‚åœ¨æ›¾ç»ç›¸é‡çš„å¤©å°ä¸Šï¼Œé›¯æ›¦é åœ¨ä½ æ€€é‡Œï¼š"è°¢è°¢ä½ è®©æˆ‘æ˜Žç™½ï¼Œå–œæ¬¢ä¸€ä¸ªäººå°±è¦å‹‡æ•¢è¯´å‡ºæ¥ã€‚"ä½ è½»å»å¥¹çš„é¢å¤´ï¼š"è°¢è°¢ä½ ä¸€ç›´åœ¨æˆ‘èº«è¾¹ï¼Œæ— è®ºæˆ‘å¤šä¹ˆè¿Ÿé’ã€‚"å¤•é˜³å°†ä½ ä»¬çš„å½±å­æ‹‰å¾—å¾ˆé•¿ï¼Œä»¿ä½›è¦å»¶ä¼¸åˆ°æ°¸è¿œã€‚é«˜ä¸­ç”Ÿæ´»å³å°†ç»“æŸï¼Œä½†ä½ ä»¬çš„æ•…äº‹æ‰åˆšåˆšå¼€å§‹ã€‚çº¦å®šå¥½è¦ä¸€èµ·è€ƒä¸ŠåŒä¸€æ‰€å¤§å­¦ï¼Œä¸€èµ·èµ°å‘æ›´ç¾Žå¥½çš„æœªæ¥ã€‚

ï¼ˆæ€»è®¡çº¦5000å­—ï¼ŒåŒ…å«8ä¸ªç« èŠ‚ï¼Œè¯¦ç»†æè¿°äº†ä»Žè¯¯ä¼šåˆ°å’Œè§£ï¼Œä»Žæš—æ‹åˆ°å‘Šç™½çš„å…¨è¿‡ç¨‹ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æœ‰ä¸°å¯Œçš„æƒ…æ„Ÿæå†™å’ŒçŽ¯å¢ƒç»†èŠ‚ï¼Œä¸ºAIç”Ÿæˆæä¾›äº†å……è¶³çš„åˆ›ä½œç´ æã€‚ï¼‰`,
  character: {
    name: 'é›¯æ›¦',
    personality: 'å‚²å¨‡ã€å®³ç¾žã€å˜´ç¡¬å¿ƒè½¯ã€æš—æ‹ä¸»è§’å¤šå¹´å´ä¸æ•¢è¡¨ç™½',
    appearance: 'é•¿ç›´é»‘å‘åŠè…°ã€ç´«ç½—å…°è‰²çœ¼çœ¸ã€æ·±è“è‰²æ°´æ‰‹æœé…çº¢è‰²é¢†å·¾ã€ç™½è‰²è¿‡è†è¢œ',
    relationship: 'ä»Žå°ä¸€èµ·é•¿å¤§çš„é‚»å±…é’æ¢…ç«¹é©¬ï¼Œæ¯å¤©ä¸€èµ·ä¸Šä¸‹å­¦'
  },
  setting: 'çŽ°ä»£æ—¥æœ¬é«˜ä¸­ï¼Œæ¨±èŠ±ç››å¼€çš„æ˜¥å¤©',
  createdAt: Date.now(),
  updatedAt: Date.now()
};

// é¢„è®¾å‰§æœ¬2ï¼šé«˜å‚²çŽ‹å›½å…¬ä¸»
const PRESET_PRINCESS: ScriptTemplate = {
  id: 'preset_princess',
  name: 'ðŸ‘‘ é«˜å‚²çŽ‹å›½å…¬ä¸»',
  description: 'å¥‡å¹»çŽ‹å›½çš„å‚²å¨‡å…¬ä¸»ä¸Žè¢«é€‰ä¸­çš„éª‘å£«æŠ¤å«ï¼Œèº«ä»½æ‚¬æ®Šçš„ç¦å¿Œä¹‹æ‹',
  plotFramework: `ã€åºç« ï¼šéª‘å£«çš„èª“è¨€ã€‘
è‰¾å°”å…°çŽ‹å›½çš„é˜³å…‰é€è¿‡å½©è‰²çŽ»ç’ƒçª—æ´’åœ¨å®ä¼Ÿçš„çŽ‹å®«å¤§åŽ…ï¼Œä½ è·ªåœ¨å›½çŽ‹é¢å‰ï¼ŒæŽ¥å—éª‘å£«å†Œå°ä»ªå¼ã€‚ä½œä¸ºçŽ‹å›½æœ€ä¼˜ç§€çš„å¹´è½»æˆ˜å£«ï¼Œä½ è¢«é€‰ä¸­æˆä¸ºå…¬ä¸»è‰¾ç³å¨œçš„ä¸“å±žæŠ¤å«ã€‚å…¬ä¸»ç«™åœ¨çŽ‹åº§æ—ï¼ŒåŽä¸½çš„ç™½è‰²å®«å»·ç¤¼æœåœ¨é˜³å…‰ä¸‹é—ªé—ªå‘å…‰ï¼Œé“¶è´¨çŽ‹å† ä¸‹çš„é‡‘è‰²é•¿å‘å¦‚ç€‘å¸ƒèˆ¬åž‚ä¸‹ã€‚å¥¹çš„çœ¼ç¥žå†°å†·è€Œé«˜å‚²ï¼Œä»¿ä½›åœ¨å®¡è§†ä¸€ä»¶ç‰©å“ã€‚"ä»Žä»Šå¤©èµ·ï¼Œä½ çš„ç”Ÿå‘½å±žäºŽå…¬ä¸»ã€‚"å›½çŽ‹åº„ä¸¥å®£å¸ƒã€‚ä½ èµ·èº«è¡Œç¤¼ï¼Œç›®å…‰ä¸Žå…¬ä¸»ç›¸é‡ï¼Œå¥¹å´è½»è”‘åœ°ç§»å¼€è§†çº¿ï¼Œä»¿ä½›åœ¨è¯´ï¼šåˆä¸€ä¸ªå‡¡äººï¼Œä¸é…å¾—åˆ°æˆ‘çš„å…³æ³¨ã€‚

ã€ç¬¬ä¸€ç« ï¼šåˆå…¥å®«å»·ã€‘
æˆä¸ºå…¬ä¸»æŠ¤å«çš„ç¬¬ä¸€å¤©ï¼Œä½ ä½“ä¼šåˆ°å‰æ‰€æœªæœ‰çš„åŽ‹åŠ›ã€‚å…¬ä¸»çš„ä½œæ¯ç²¾ç¡®åˆ°åˆ†é’Ÿï¼Œå¥¹çš„è¦æ±‚è‹›åˆ»åˆ°æžè‡´ã€‚æ¸…æ™¨äº”ç‚¹ï¼Œä½ è¦åœ¨å¥¹èµ·åºŠå‰æ£€æŸ¥æ‰€æœ‰æˆ¿é—´çš„å®‰å…¨ï¼›ç”¨é¤æ—¶ï¼Œä½ è¦ç«™åœ¨ä¸€æ—ç¡®ä¿é£Ÿç‰©æ— æ¯’ï¼›æ•£æ­¥æ—¶ï¼Œä½ è¦ä¿æŒä¸‰æ­¥çš„è·ç¦»ï¼Œæ—¢ä¸èƒ½å¤ªè¿œä¹Ÿä¸èƒ½å¤ªè¿‘ã€‚å¥¹ä»Žä¸æ­£çœ¼çœ‹ä½ ï¼Œç§°å‘¼æ°¸è¿œæ˜¯"å–‚"æˆ–è€…"é‚£ä¸ªæŠ¤å«"ã€‚æŸå¤©ï¼Œä½ ä¸å°å¿ƒè¸©è„äº†å¥¹çš„åœ°æ¯¯ï¼Œå¥¹å†·å†·åœ°è¯´ï¼š"çœ‹æ¥å¹³æ°‘çš„æ•™å…»å°±æ˜¯å¦‚æ­¤ã€‚"ä½ é»˜é»˜å¿å—ï¼Œå¿ƒä¸­å´ç‡ƒèµ·è¯æ˜Žè‡ªå·±çš„å†³å¿ƒã€‚

ã€ç¬¬äºŒç« ï¼šå‚²æ…¢çš„è€ƒéªŒã€‘
å…¬ä¸»å¼€å§‹åˆ»æ„åˆéš¾ä½ ã€‚å¥¹è¦æ±‚ä½ åœ¨æš´é›¨ä¸­ç«™å²—ï¼Œåœ¨å¯’å¤œé‡Œå·¡è§†ï¼Œç”šè‡³è®©ä½ å•æ‰‹ä¸¾èµ·æ²‰é‡çš„è®­ç»ƒå‰‘ç›´åˆ°åŠ›ç«­ã€‚å®«ä¸­å…¶ä»–è´µæ—å˜²ç¬‘ä½ ï¼Œä½†ä½ ä»ŽæœªæŠ±æ€¨ã€‚æŸæ¬¡è®­ç»ƒï¼Œä½ å‡»è´¥äº†æ‰€æœ‰æŒ‘æˆ˜è€…ï¼Œå…¬ä¸»å´åœ¨è§‚èµ›åŽè¯´ï¼š"ä¸è¿‡æ˜¯èŠ±æ‹³ç»£è…¿ã€‚"çœŸæ­£è®©ä½ å¿ƒå¯’çš„æ˜¯ï¼Œå¥¹æ•…æ„åœ¨ä½ é¢å‰å¤¸å¥–å…¶ä»–éª‘å£«çš„è‹±å‹‡ï¼Œä»¿ä½›åœ¨åˆºæ¿€ä½ è¾žèŒã€‚ä½†ä½ æ˜Žç™½ï¼Œè¿™æ˜¯å¥¹å¯¹æ‰€æœ‰æŠ¤å«çš„è€ƒéªŒâ€”â€”åªæœ‰çœŸæ­£å¿ è¯šä¸”å¼ºå¤§çš„äººæ‰èƒ½ç•™ä¸‹ã€‚

ã€ç¬¬ä¸‰ç« ï¼šæ„å¤–çš„æ¸©æŸ”ã€‘
ä¸€ä¸ªæœˆåœ†ä¹‹å¤œï¼Œä½ å·¡é€»æ—¶å‘çŽ°å…¬ä¸»ç‹¬è‡ªåœ¨èŠ±å›­é‡Œå“­æ³£ã€‚æœˆå…‰ä¸‹ï¼Œå¥¹å¸ä¸‹äº†ç™½å¤©çš„å‚²æ…¢é¢å…·ï¼Œåƒä¸ªæ— åŠ©çš„å¥³å­©ã€‚ä½ çŠ¹è±«æ˜¯å¦è¯¥ä¸Šå‰ï¼Œæœ€ç»ˆé€‰æ‹©é»˜é»˜å®ˆæŠ¤ã€‚çªç„¶ï¼Œå¥¹å‘çŽ°äº†ä½ ï¼š"ä½ ...åœ¨è¿™é‡Œåšä»€ä¹ˆï¼Ÿ"å£°éŸ³é‡Œå¸¦ç€æ…Œä¹±ã€‚ä½ æ­æ•¬å›žç­”ï¼š"å±¥è¡ŒèŒè´£ï¼Œä¿æŠ¤å…¬ä¸»å®‰å…¨ã€‚"å¥¹æ²‰é»˜ç‰‡åˆ»ï¼Œè½»å£°è¯´ï¼š"ä»Šæ™šçš„äº‹ï¼Œä¸è®¸å‘Šè¯‰ä»»ä½•äººã€‚"è¿™æ˜¯å¥¹ç¬¬ä¸€æ¬¡ç”¨æ­£å¸¸çš„è¯­æ°”å’Œä½ è¯´è¯ã€‚ä½ ç‚¹å¤´ç­”åº”ï¼Œå¿ƒä¸­å´æ³›èµ·æ¶Ÿæ¼ªã€‚

ã€ç¬¬å››ç« ï¼šå®«å»·é˜´è°‹ã€‘
çŽ‹å›½å†…éƒ¨æš—æµæ¶ŒåŠ¨ã€‚æŸäº›è´µæ—å¯¹å›½çŽ‹çš„æ”¹é©ä¸æ»¡ï¼Œå°†ç›®æ ‡å¯¹å‡†äº†å…¬ä¸»ã€‚ä½ å‘çŽ°æœ‰äººåœ¨å…¬ä¸»çš„é£Ÿç‰©ä¸­ä¸‹è¯ï¼ŒåŠæ—¶é˜»æ­¢å¹¶æš—ä¸­è°ƒæŸ¥ã€‚å…¬ä¸»è™½ç„¶è¡¨é¢å†·æ¼ ï¼Œä½†å†…å¿ƒæ•æ„Ÿï¼Œå¥¹å¯Ÿè§‰åˆ°äº†å±é™©å´ä¸æ„¿ç¤ºå¼±ã€‚æŸå¤©æ·±å¤œï¼Œä½ æˆªèŽ·äº†ä¸€å°å¯†ä¿¡ï¼Œå¾—çŸ¥æœ‰äººè®¡åˆ’åœ¨å…¬ä¸»ç”Ÿæ—¥å®´ä¼šä¸Šè¡Œåˆºã€‚ä½ ç«‹å³ä¸ŠæŠ¥ï¼Œå´é­åˆ°æŸäº›å¤§è‡£çš„è´¨ç–‘ã€‚å…¬ä¸»åœ¨å…³é”®æ—¶åˆ»ç«™å‡ºæ¥ï¼š"æˆ‘ç›¸ä¿¡æˆ‘çš„æŠ¤å«ã€‚"è¿™æ˜¯å¥¹ç¬¬ä¸€æ¬¡åœ¨å…¬å¼€åœºåˆç»´æŠ¤ä½ ã€‚

ã€ç¬¬äº”ç« ï¼šå‡ºå·¡å±æœºã€‘
æ˜¥å¤©æ¥ä¸´ï¼Œå…¬ä¸»å†³å®šå·¡è§†è¾¹å¢ƒåŸŽé•‡ï¼Œå®‰æŠšæ°‘å¿ƒã€‚è¿™æ˜¯ä¸€æ¬¡å±é™©çš„ä»»åŠ¡ï¼Œæ²¿é€”å±±è·¯å´Žå²–ï¼Œç›—åŒªæ¨ªè¡Œã€‚ä½ ç²¾å¿ƒç­–åˆ’è·¯çº¿ï¼ŒåŠ å¼ºäº†æŠ¤å«åŠ›é‡ã€‚æ—…é€”ä¸­ï¼Œå…¬ä¸»ç¬¬ä¸€æ¬¡çœ‹åˆ°å¹³æ°‘çš„ç”Ÿæ´»ï¼Œå¥¹çš„çœ¼ç¥žé€æ¸å˜åŒ–ã€‚æŸä¸ªå¤œæ™šï¼Œå®¢æ ˆé­é‡è¢­å‡»ï¼Œä½ å¥‹åŠ›ä¿æŠ¤å¥¹ï¼Œæ‰‹è‡‚å—ä¼¤ã€‚å¥¹ç´§å¼ åœ°é—®ï¼š"ä½ æ²¡äº‹å§ï¼Ÿ"ä½ å¼ºå¿ç–¼ç—›ï¼š"ä¿æŠ¤å…¬ä¸»æ˜¯æˆ‘çš„èŒè´£ã€‚"å¥¹é»˜é»˜ä¸ºä½ åŒ…æ‰Žä¼¤å£ï¼ŒåŠ¨ä½œç¬¨æ‹™å´æ¸©æŸ”ã€‚é‚£ä¸€åˆ»ï¼Œä½ ä»¬ä¹‹é—´çš„è·ç¦»æ‚„ç„¶æ‹‰è¿‘ã€‚

ã€ç¬¬å…­ç« ï¼šç”Ÿæ­»æŠ‰æ‹©ã€‘
åœ¨è¿”å›žçŽ‹éƒ½çš„è·¯ä¸Šï¼Œé­é‡äº†ç²¾å¿ƒç­–åˆ’çš„ä¼å‡»ã€‚æ•°åååˆºå®¢åŒ…å›´äº†ä½ ä»¬ï¼Œæ˜Žæ˜¾æ˜¯è®­ç»ƒæœ‰ç´ çš„æ€æ‰‹ã€‚æˆ˜æ–—å¼‚å¸¸æ¿€çƒˆï¼ŒæŠ¤å«ä¸€ä¸ªä¸ªå€’ä¸‹ã€‚åœ¨æœ€å±æ€¥çš„æ—¶åˆ»ï¼Œä½ æŒ¡åœ¨å…¬ä¸»èº«å‰ï¼Œèº«ä¸­æ•°åˆ€å´ä¾ç„¶å±¹ç«‹ä¸å€’ã€‚"å¿«èµ°ï¼"ä½ å¯¹å…¬ä¸»å–Šé“ã€‚å¥¹æ³ªæµæ»¡é¢ï¼š"æˆ‘ä¸èƒ½ä¸¢ä¸‹ä½ ï¼"åˆºå®¢çš„é¦–é¢†ç‹žç¬‘ç€é€¼è¿‘ï¼Œä½ ç”¨å°½æœ€åŽåŠ›æ°”å°†ä»–å‡»å€’ï¼Œè‡ªå·±ä¹Ÿå€’åœ¨äº†è¡€æ³Šä¸­ã€‚å¤±åŽ»æ„è¯†å‰ï¼Œä½ å¬åˆ°å…¬ä¸»çš„å“­å–Šï¼š"ä¸è¦æ­»...æ±‚æ±‚ä½ ..."

ã€ç¬¬ä¸ƒç« ï¼šçœŸæƒ…æµéœ²ã€‘
ä½ åœ¨çŽ‹å®«çš„åŒ»åŠ¡å®¤é†’æ¥ï¼Œä¸‰å¤©ä¸‰å¤œçš„æ˜è¿·è®©å…¬ä¸»æ†”æ‚´ä¸å ªã€‚å¥¹å®ˆåœ¨ä½ åºŠè¾¹ï¼Œçœ¼ä¸­æ»¡æ˜¯è¡€ä¸ã€‚çœ‹åˆ°ä½ é†’æ¥ï¼Œå¥¹å–œæžè€Œæ³£ï¼š"ä½ è¿™ä¸ªç¬¨è›‹...ä¸ºä»€ä¹ˆè¦åšåˆ°é‚£ç§åœ°æ­¥ï¼Ÿ"ä½ è™šå¼±åœ°å¾®ç¬‘ï¼š"ä¿æŠ¤å…¬ä¸»æ˜¯æˆ‘çš„ä½¿å‘½ã€‚"å¥¹æ¡ä½ä½ çš„æ‰‹ï¼š"ä¸...ä¸åªæ˜¯ä½¿å‘½ã€‚"å¥¹ç»ˆäºŽæ”¾ä¸‹æ‰€æœ‰éª„å‚²ï¼Œ"æˆ‘...æˆ‘ä¸æƒ³å¤±åŽ»ä½ ã€‚"è¿™æ˜¯å¥¹ç¬¬ä¸€æ¬¡æ‰¿è®¤å†…å¿ƒçš„çœŸå®žæ„Ÿå—ã€‚ä½ åæ¡ä½å¥¹çš„æ‰‹ï¼š"æˆ‘ä¹Ÿä¸€æ ·ã€‚"

ã€ç¬¬å…«ç« ï¼šèº«ä»½çš„éš”é˜‚ã€‘
ä¼¤æ„ˆåŽï¼Œä½ ä»¬çš„å…³ç³»å˜å¾—å¾®å¦™ã€‚å…¬ä¸»ä¸å†åˆ»æ„åˆéš¾ä½ ï¼Œè€Œæ˜¯ä¼šå…³å¿ƒä½ çš„èº«ä½“çŠ¶å†µï¼Œä¼šå’Œä½ è®¨è®ºå›½äº‹ã€‚ä½†èº«ä»½çš„å·®è·ä¾ç„¶å­˜åœ¨ã€‚æŸå¤©ï¼Œå›½çŽ‹å¬è§ä½ ï¼š"å…¬ä¸»å¯¹ä½ å¦çœ¼ç›¸çœ‹ï¼Œä½†ä½ ä»¬èº«ä»½æ‚¬æ®Šã€‚"å›½çŽ‹çš„è¯è®©ä½ æ¸…é†’ã€‚ä½ å¼€å§‹åˆ»æ„ä¿æŒè·ç¦»ï¼Œå…¬ä¸»å¯Ÿè§‰åŽè´¨é—®ï¼š"ä½ åœ¨èº²ç€æˆ‘ï¼Ÿ""å…¬ä¸»æ®¿ä¸‹ï¼Œæˆ‘ä»¬èº«ä»½ä¸åŒã€‚"ä½ æ­æ•¬å›žç­”ã€‚å¥¹çœ¼ä¸­é—ªè¿‡å—ä¼¤ï¼š"èº«ä»½å°±é‚£ä¹ˆé‡è¦å—ï¼Ÿ"

ã€ç¬¬ä¹ç« ï¼šå‹‡æ•¢çš„å‘Šç™½ã€‘
åœ¨çŽ‹å›½çš„åº†å…¸ä¸Šï¼Œå…¬ä¸»å½“ä¼—å®£å¸ƒè¦é€‰æ‹©è‡ªå·±çš„ä¼´ä¾£ã€‚æ‰€æœ‰è´µæ—éƒ½ä»¥ä¸ºå¥¹ä¼šé€‰æ‹©æŸä½çŽ‹å­ï¼Œä½†å¥¹å´èµ°åˆ°äº†ä½ é¢å‰ã€‚"è‰¾å°”å…°çŽ‹å›½çš„å…¬ä¸»ï¼Œè¦é€‰æ‹©çš„ä¸æ˜¯åœ°ä½æ˜¾èµ«çš„çŽ‹å­ï¼Œè€Œæ˜¯ä¸€ä¸ªçœŸæ­£çˆ±å¥¹ã€ä¿æŠ¤å¥¹çš„äººã€‚"å¥¹å•è†è·ªä¸‹ï¼Œéœ‡æƒŠäº†æ‰€æœ‰äººï¼š"ä½ æ„¿æ„...æŽ¥å—æˆ‘çš„å¿ƒå—ï¼Ÿ"æ•´ä¸ªçŽ‹å®«é™·å…¥å¯‚é™ï¼Œä½ æ¿€åŠ¨å¾—è¯´ä¸å‡ºè¯ã€‚å›½çŽ‹æœ€ç»ˆå¼€å£ï¼š"å¦‚æžœè¿™æ˜¯ä½ çš„é€‰æ‹©ï¼Œæˆ‘åŒæ„ã€‚"

ã€ç¬¬åç« ï¼šçˆ±çš„èª“è¨€ã€‘
åœ¨çŽ‹å›½çš„æ•™å ‚é‡Œï¼Œä¸¾è¡Œäº†ç®€å•çš„ä»ªå¼ã€‚å…¬ä¸»è„±ä¸‹äº†åŽä¸½çš„çŽ‹å† ï¼Œæ¢ä¸Šäº†æœ´ç´ çš„ç™½è£™ã€‚ä½ ç©¿ä¸Šäº†ç‰¹åˆ¶çš„ç¤¼æœï¼Œä¸å†æ˜¯æŠ¤å«ï¼Œè€Œæ˜¯çŽ‹å­ã€‚åœ¨ç¥žçˆ¶é¢å‰ï¼Œä½ ä»¬äº¤æ¢èª“è¨€ï¼š"æ— è®ºè´«å¯Œã€ç–¾ç—…ã€å±é™©ï¼Œæˆ‘éƒ½ä¼šå®ˆæŠ¤ä½ ä¸€ç”Ÿä¸€ä¸–ã€‚"å…¬ä¸»çœ¼ä¸­å«æ³ªï¼š"æˆ‘ä¹Ÿæ˜¯ã€‚"é˜³å…‰é€è¿‡å½©è‰²çŽ»ç’ƒæ´’åœ¨ä½ ä»¬èº«ä¸Šï¼Œä»¿ä½›ç¥žçš„ç¥ç¦ã€‚ä»Žé‚£å¤©èµ·ï¼Œè‰¾å°”å…°çŽ‹å›½æœ‰äº†æ–°çš„çŽ‹å­ï¼Œä¹Ÿæœ‰äº†æ–°çš„ç«¥è¯ã€‚

ã€ç»ˆç« ï¼šæ°¸æ’çš„çˆ±ã€‘
å¤šå¹´åŽï¼Œä½ ä»¬æˆä¸ºäº†è‰¾å°”å…°çŽ‹å›½æœ€å—çˆ±æˆ´çš„å›½çŽ‹å’ŒçŽ‹åŽã€‚å…¬ä¸»çš„å‚²æ…¢å˜æˆäº†å¨ä¸¥ï¼Œä½ çš„å¿ è¯šå˜æˆäº†æ™ºæ…§ã€‚ä½ ä»¬å…±åŒæ²»ç†å›½å®¶ï¼Œè®©çŽ‹å›½ç¹è£æ˜Œç››ã€‚æ¯ä¸ªç»“å©šçºªå¿µæ—¥ï¼Œä½ ä»¬éƒ½ä¼šå›žåˆ°åˆæ¬¡ç›¸é‡çš„çŽ‹å®«å¤§åŽ…ï¼Œå›žå¿†é‚£ä¸ªé›¨å¤©ã€‚å…¬ä¸»æ€»æ˜¯ç¬‘ç€è¯´ï¼š"é‚£å¤©æˆ‘çœŸçš„å¾ˆè®¨åŽŒä½ ã€‚"ä½ å›žç­”ï¼š"æˆ‘ä¹Ÿæ˜¯ã€‚"ç„¶åŽç›¸è§†è€Œç¬‘ã€‚èº«ä»½çš„å·®è·æ—©å·²æ¶ˆå¤±ï¼Œå‰©ä¸‹çš„åªæœ‰æ°¸æ’çš„çˆ±ã€‚

ï¼ˆæ€»è®¡çº¦5000å­—ï¼ŒåŒ…å«10ä¸ªç« èŠ‚ï¼Œè¯¦ç»†æè¿°äº†ä»Žå‚²æ…¢åˆ°æ¸©æŸ”ï¼Œä»Žèº«ä»½éš”é˜‚åˆ°çœŸçˆ±çš„å…¨è¿‡ç¨‹ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æœ‰ä¸°å¯Œçš„æƒ…æ„Ÿæå†™å’Œå®«å»·ç»†èŠ‚ï¼Œä¸ºAIç”Ÿæˆæä¾›äº†å……è¶³çš„åˆ›ä½œç´ æã€‚ï¼‰`,
  character: {
    name: 'è‰¾ç³å¨œ',
    personality: 'é«˜å‚²å†·è‰³ã€è´£ä»»å¿ƒå¼ºã€å¤–å†·å†…çƒ­ã€åŽŒå€¦å®«å»·æŸç¼šæ¸´æœ›è‡ªç”±ã€å¯¹çœŸå¿ƒä¹‹äººä¼šéœ²å‡ºæ¸©æŸ”ä¸€é¢',
    appearance: 'é‡‘è‰²é•¿å·å‘å¦‚ç€‘å¸ƒã€å®çŸ³è“çœ¼çœ¸ã€åŽä¸½ç™½è‰²å®«å»·ç¤¼æœã€å¤´æˆ´é“¶è´¨çŽ‹å† ',
    relationship: 'è‰¾å°”å…°çŽ‹å›½å”¯ä¸€çš„å…¬ä¸»æ®¿ä¸‹ï¼Œä½ æ˜¯è¢«é€‰ä¸­çš„éª‘å£«æŠ¤å«'
  },
  setting: 'ä¸­ä¸–çºªæ¬§æ´²é£Žæ ¼å¥‡å¹»çŽ‹å›½ï¼Œé­”æ³•ä¸Žå‰‘çš„æ—¶ä»£',
  createdAt: Date.now(),
  updatedAt: Date.now()
};

// é¢„è®¾å‰§æœ¬3ï¼šå¤é£Žç»ä¸–èŠ±é­
const PRESET_COURTESAN: ScriptTemplate = {
  id: 'preset_courtesan',
  name: 'ðŸŒ¸ å¤é£Žç»ä¸–èŠ±é­',
  description: 'è½é­„ä¹¦ç”Ÿä¸Žäº¬åŸŽç¬¬ä¸€èŠ±é­çš„å€¾åŸŽä¹‹æ‹ï¼Œé£Žå°˜ä¸­å¯»è§…çœŸå¿ƒ',
  plotFramework: `ã€åºç« ï¼šçƒŸé›¨åˆé€¢ã€‘
æ±Ÿå—çƒŸé›¨æœ¦èƒ§çš„å¤œæ™šï¼Œä½ è¿™ä½è½é­„ä¹¦ç”Ÿæ€€æ£ç€æœ€åŽçš„é“¶ä¸¤ï¼Œèµ°è¿›äº†äº¬åŸŽæœ€æœ‰åçš„é†‰æœˆæ¥¼ã€‚æœ¬æƒ³å€Ÿé…’æ¶ˆæ„ï¼Œå´è¢«æ¥¼ä¸Šé£˜æ¥çš„ç´å£°å¸å¼•ã€‚å¾ªå£°è€Œä¸Šï¼Œåªè§ä¸€ä½ç»è‰²å¥³å­æ­£æŠšç´è€Œæ­Œï¼Œå¥¹ä¾¿æ˜¯äº¬åŸŽç¬¬ä¸€èŠ±é­æŸ³å¦‚çƒŸã€‚ç»›çº¢ç½—è£™æ›³åœ°ï¼Œä¹Œå‘äº‘é¬“æ–œæ’çŽ‰ç°ªï¼ŒæŸ³çœ‰æçœ¼å«æƒ…è„‰è„‰ã€‚å¥¹çš„æ­Œå£°å¦‚æ³£å¦‚è¯‰ï¼Œå”±çš„æ­£æ˜¯ä½ å¿ƒä¸­çš„æ„è‹¦ã€‚ä¸€æ›²ç»ˆäº†ï¼Œä½ æƒ…ä¸è‡ªç¦åœ°é¼“æŽŒå–å½©ï¼š"å¥½ï¼æ­¤æ›²åªåº”å¤©ä¸Šæœ‰ï¼Œäººé—´èƒ½å¾—å‡ å›žé—»ï¼"å¥¹æŠ¬çœ¼çœ‹æ¥ï¼Œçœ¼ä¸­é—ªè¿‡ä¸€ä¸æƒŠè®¶ï¼š"è¿™ä½å…¬å­å€’æ˜¯è¯†è´§ã€‚"

ã€ç¬¬ä¸€ç« ï¼šæ‰æƒ…ç›¸æƒœã€‘
ä»Žæ­¤ï¼Œä½ æˆäº†é†‰æœˆæ¥¼çš„å¸¸å®¢ã€‚è™½ç„¶å›Šä¸­ç¾žæ¶©ï¼Œä½†æ¯æ¬¡éƒ½ä¼šå¸¦æ¥è‡ªå·±å†™çš„è¯—è¯ã€‚æŸ³å¦‚çƒŸæ¸æ¸å¯¹ä½ å¦çœ¼ç›¸çœ‹ï¼Œä¸ä»…å› ä¸ºä½ çš„æ‰æƒ…ï¼Œæ›´å› ä¸ºä½ çœ¼ä¸­é‚£ä»½ä¸åŒäºŽå…¶ä»–å®¢äººçš„çœŸè¯šã€‚æŸå¤œï¼Œä½ ä»¬åœ¨æœˆä¸‹å¯¹è¯—ï¼Œå¥¹çš„æ‰æƒ…è®©ä½ æƒŠå¹ï¼š"å§‘å¨˜çš„è¯—è¯ï¼Œä¸è®©é¡»çœ‰ã€‚"å¥¹è½»ç¬‘ï¼š"å…¬å­çš„æ‰åŽï¼Œå¦‚çƒŸè‡ªæ„§ä¸å¦‚ã€‚"é‚£ä¸€åˆ»ï¼Œä½ ä»¬ä»¿ä½›æ‰¾åˆ°äº†çŸ¥éŸ³ã€‚ä½†ä½ ä¹Ÿæ¸…æ¥šï¼Œå¥¹æ˜¯èŠ±é­ï¼Œè€Œä½ åªæ˜¯ä¸ªç©·ä¹¦ç”Ÿï¼Œèº«ä»½çš„å·®è·å¦‚åŒå¤©å ‘ã€‚

ã€ç¬¬äºŒç« ï¼šæš—ç”Ÿæƒ…æ„«ã€‘
éšç€ç›¸å¤„æ¸å¤šï¼Œä½ ä»¬ä¹‹é—´çš„æƒ…æ„«æ‚„ç„¶æ»‹ç”Ÿã€‚å¥¹ä¼šä¸ºä½ ç•™æœ€å¥½çš„ä½ç½®ï¼Œä½ ä¼šä¸ºå¥¹å¸¦æ¥æ–°å†™çš„è¯—ç¯‡ã€‚æŸæ¬¡ä½ ç”Ÿç—…æ²¡èƒ½å‰æ¥ï¼Œå¥¹ç«Ÿäº²è‡ªåˆ°ä½ ä½å¤„æŽ¢æœ›ï¼Œå¸¦æ¥çè´µçš„è¯æã€‚ä½ æ„ŸåŠ¨ä¸å·²ï¼š"å§‘å¨˜ä¸ºä½•å¦‚æ­¤ï¼Ÿ"å¥¹è½»å¹ï¼š"å› ä¸ºä½ æ˜¯å”¯ä¸€æŠŠæˆ‘å½“äººçœ‹çš„äººã€‚"åœ¨é†‰æœˆæ¥¼ï¼Œæ‰€æœ‰äººéƒ½åªçœ‹é‡å¥¹çš„ç¾Žè²Œå’Œæ‰è‰ºï¼Œåªæœ‰ä½ çœ‹åˆ°äº†å¥¹å†…å¿ƒçš„å­¤ç‹¬ã€‚é‚£å¤œï¼Œä½ ä»¬ç¬¬ä¸€æ¬¡è°ˆåŠå„è‡ªçš„è¿‡åŽ»ï¼Œå¥¹çš„çœ¼ä¸­æ³›èµ·æ³ªå…‰ã€‚

ã€ç¬¬ä¸‰ç« ï¼šæƒè´µè§Šè§Žã€‘
æŸ³å¦‚çƒŸçš„ç¾Žè²Œå’Œæ‰æƒ…å¼•æ¥äº†æƒè´µçš„è§Šè§Žã€‚åéƒ¨å°šä¹¦ä¹‹å­çŽ‹å…¬å­å¯¹å¥¹çº ç¼ ä¸ä¼‘ï¼ŒæŒ¥é‡‘å¦‚åœŸåœ°æƒ³è¦ä¹°ä¸‹å¥¹çš„åˆå¤œã€‚è€é¸¨è§é’±çœ¼å¼€ï¼Œä¸æ–­æ–½åŽ‹ã€‚æŸ³å¦‚çƒŸå¿ƒä¸­åªæœ‰ä½ ï¼Œå´æ— æ³•æ‘†è„±è¿™äº›çº ç¼ ã€‚æŸå¤©ï¼ŒçŽ‹å…¬å­åœ¨é†‰æœˆæ¥¼å¤§é—¹ï¼Œè¦å¼ºè¡Œå¸¦èµ°æŸ³å¦‚çƒŸã€‚ä½ æŒºèº«è€Œå‡ºï¼Œè™½è¢«å®¶ä¸æ‰“å¾—éä½“é³žä¼¤ï¼Œå´æŠ¤ä½äº†å¥¹ã€‚å¥¹å¿ƒç–¼åœ°ä¸ºä½ åŒ…æ‰Žï¼š"ä½ è¿™ä¸ªå‚»å­ï¼Œä½•å¿…å¦‚æ­¤ï¼Ÿ"ä½ åšå®šåœ°è¯´ï¼š"æˆ‘ä¸èƒ½çœ¼çœ‹ä½ å—è¾±ã€‚"

ã€ç¬¬å››ç« ï¼šèº«ä¸ç”±å·±ã€‘
çŽ‹å…¬å­ä¸è‚¯ç½¢ä¼‘ï¼ŒåŠ¨ç”¨æƒåŠ¿å‘é†‰æœˆæ¥¼æ–½åŽ‹ã€‚è€é¸¨å®³æ€•å¾—ç½ªæƒè´µï¼Œå¼€å§‹é™åˆ¶æŸ³å¦‚çƒŸçš„è‡ªç”±ï¼Œç”šè‡³å¨èƒè¦å°†å¥¹å–ç»™çŽ‹å…¬å­ã€‚æŸ³å¦‚çƒŸé™·å…¥ç»å¢ƒï¼Œå¥¹çŸ¥é“å”¯æœ‰è„±ç¦»èŠ±æ¥¼æ‰èƒ½èŽ·å¾—è‡ªç”±ï¼Œä½†èµŽèº«çš„é“¶ä¸¤å¯¹å¥¹æ¥è¯´å¦‚åŒå¤©æ–‡æ•°å­—ã€‚æŸå¤œï¼Œå¥¹å“­ç€å¯¹ä½ è¯´ï¼š"å¦‚çƒŸæ­¤ç”Ÿæ€•æ˜¯éš¾é€ƒåŽ„è¿äº†ã€‚"ä½ å¿ƒå¦‚åˆ€ç»žï¼Œå´æ— èƒ½ä¸ºåŠ›ã€‚ä½ æš—ä¸‹å†³å¿ƒï¼šä¸€å®šè¦è€ƒå–åŠŸåï¼Œä¸€å®šè¦æ•‘å¥¹è„±ç¦»è‹¦æµ·ã€‚

ã€ç¬¬äº”ç« ï¼šå¯’çª—è‹¦è¯»ã€‘
ä¸ºäº†æŸ³å¦‚çƒŸï¼Œä½ å‘å¥‹è‹¦è¯»ã€‚æ¯å¤©å¤©ä¸äº®å°±èµ·åºŠï¼Œæ·±å¤œè¿˜åœ¨ç¯ä¸‹è‹¦è¯»ã€‚æŸ³å¦‚çƒŸå¾—çŸ¥åŽï¼Œæ‚„æ‚„ä¸ºä½ å‡†å¤‡å¤œå®µï¼Œä¸ºä½ æ´—è¡£è¡¥è¡£ã€‚è™½ç„¶èº«å¤„å›°å¢ƒï¼Œä½†ä½ ä»¬çš„æ„Ÿæƒ…å´è¶Šæ¥è¶Šæ·±ã€‚å¥¹ä¼šä¸ºä½ å¼¹ç´è§£ä¹ï¼Œä½ ä¼šä¸ºå¥¹è®²ä¹¦ä¸­çš„æ•…äº‹ã€‚æŸå¤©ï¼Œä½ å®žåœ¨æ”¯æ’‘ä¸ä½ï¼Œç—…å€’åœ¨ä¹¦æ¡Œå‰ã€‚å¥¹å®ˆåœ¨ä½ èº«è¾¹ä¸‰å¤©ä¸‰å¤œï¼Œæ‚‰å¿ƒç…§æ–™ã€‚é†’æ¥åŽï¼Œä½ æ¡ä½å¥¹çš„æ‰‹ï¼š"å¦‚çƒŸï¼Œç­‰æˆ‘ï¼Œæˆ‘ä¸€å®šä¼šè®©ä½ è¿‡ä¸Šå¥½æ—¥å­ã€‚"å¥¹å«æ³ªç‚¹å¤´ï¼š"æˆ‘ç­‰ä½ ã€‚"

ã€ç¬¬å…­ç« ï¼šä¸´è¡Œä¹‹å¤œã€‘
ç§‘ä¸¾è€ƒè¯•çš„æ—¥å­ä¸´è¿‘ï¼Œä½ å¿…é¡»èµ¶èµ´äº¬åŸŽã€‚ä¸´è¡Œå‰å¤œï¼Œä½ ä»¬åœ¨é†‰æœˆæ¥¼æœ€åŽä¸€æ¬¡ç›¸è§ã€‚æŸ³å¦‚çƒŸä¸ºä½ å‡†å¤‡äº†è¡Œè£…ï¼Œæ¯ä¸€ä»¶éƒ½äº²æ‰‹ç¼åˆ¶ã€‚å¥¹æ‹¿å‡ºè‡ªå·±æ‰€æœ‰çš„ç§¯è“„ï¼š"è¿™äº›é“¶ä¸¤ä½ å¸¦ç€ï¼Œè·¯ä¸Šç”¨ã€‚"ä½ æŽ¨è¾žä¸è¦ï¼Œå¥¹å´åšæŒï¼š"æ‹¿ç€ï¼Œè¿™æ˜¯æˆ‘çš„å¿ƒæ„ã€‚"é‚£å¤œï¼Œä½ ä»¬ç›¸æ‹¥è€Œæ³£ï¼Œçº¦å®šé‡‘æ¦œé¢˜åä¹‹æ—¥å°±æ˜¯é‡é€¢ä¹‹æ—¶ã€‚å¥¹è½»æŠšä½ çš„è„¸ï¼š"æ— è®ºç»“æžœå¦‚ä½•ï¼Œå¦‚çƒŸéƒ½ç­‰ä½ å›žæ¥ã€‚"ä½ éƒ‘é‡æ‰¿è¯ºï¼š"æ­¤ç”Ÿæ­¤ä¸–ï¼Œæˆ‘å®šä¸è´Ÿä½ ã€‚"

ã€ç¬¬ä¸ƒç« ï¼šé‡‘æ¦œé¢˜åã€‘
ç»è¿‡æ•°æœˆçš„ç…Žç†¬ï¼Œç»ˆäºŽåˆ°äº†æ”¾æ¦œçš„æ—¥å­ã€‚å½“çœ‹åˆ°è‡ªå·±çš„åå­—ä½åˆ—çŠ¶å…ƒæ—¶ï¼Œä½ æ¿€åŠ¨å¾—çƒ­æ³ªç›ˆçœ¶ã€‚ç¬¬ä¸€æ—¶é—´ï¼Œä½ èµ¶å›žé†‰æœˆæ¥¼ï¼Œæƒ³è¦å‘Šè¯‰æŸ³å¦‚çƒŸè¿™ä¸ªå¥½æ¶ˆæ¯ã€‚ç„¶è€Œï¼Œé†‰æœˆæ¥¼çš„æ™¯è±¡è®©ä½ å¿ƒå¦‚åˆ€ç»žâ€”â€”æ¥¼é—¨ç´§é—­ï¼Œè´´ç€å°æ¡ã€‚é‚»å±…å‘Šè¯‰ä½ ï¼ŒæŸ³å¦‚çƒŸå› ä¸ºæ‹’ç»çŽ‹å…¬å­ï¼Œè¢«è€é¸¨å–ç»™äº†å¤–åœ°çš„ä¸€å®¶é’æ¥¼ã€‚ä½ å¦‚é­é›·å‡»ï¼Œç«‹å³å››å¤„æ‰“å¬å¥¹çš„ä¸‹è½ã€‚

ã€ç¬¬å…«ç« ï¼šåƒé‡Œå¯»èŠ³ã€‘
å¾—çŸ¥æŸ³å¦‚çƒŸè¢«å–åˆ°äº†æ‰¬å·žï¼Œä½ æ¯«ä¸çŠ¹è±«åœ°è¾žåŽ»å®˜èŒï¼Œå¸¦ç€æ‰€æœ‰é“¶ä¸¤èµ¶èµ´æ‰¬å·žã€‚ç»è¿‡åŠä¸ªæœˆçš„å¯»æ‰¾ï¼Œä½ ç»ˆäºŽåœ¨ä¸€å¤„ååƒ»çš„é’æ¥¼æ‰¾åˆ°äº†å¥¹ã€‚æ­¤æ—¶çš„å¥¹æ†”æ‚´ä¸å ªï¼Œå¤±åŽ»äº†å¾€æ—¥çš„å…‰å½©ã€‚çœ‹åˆ°ä½ çš„é‚£ä¸€åˆ»ï¼Œå¥¹ä¸æ•¢ç›¸ä¿¡è‡ªå·±çš„çœ¼ç›ï¼š"ä½ ...ä½ æ€Žä¹ˆæ¥äº†ï¼Ÿ"ä½ ç´§ç´§æŠ±ä½å¥¹ï¼š"æˆ‘æ¥æŽ¥ä½ å›žå®¶ã€‚"å¥¹æ³ªå¦‚é›¨ä¸‹ï¼š"æˆ‘å·²ç»ä¸å¹²å‡€äº†..."ä½ è½»æŠšå¥¹çš„å¤´å‘ï¼š"åœ¨æˆ‘å¿ƒä¸­ï¼Œä½ æ°¸è¿œæ˜¯æœ€ç¾Žçš„ã€‚"

ã€ç¬¬ä¹ç« ï¼šé‡é‡‘èµŽèº«ã€‘
é’æ¥¼è€æ¿è§ä½ æ˜¯æ–°ç§‘çŠ¶å…ƒï¼Œç‹®å­å¤§å¼€å£è¦ä»·ä¸‡ä¸¤ç™½é“¶ã€‚ä½ æ¯«ä¸çŠ¹è±«åœ°æ‹¿å‡ºæ‰€æœ‰ç§¯è“„ï¼Œåˆå‘æœ‹å‹å€Ÿè´·ï¼Œç»ˆäºŽå‡‘å¤Ÿäº†èµŽèº«çš„é“¶ä¸¤ã€‚å½“æŸ³å¦‚çƒŸç»ˆäºŽèŽ·å¾—è‡ªç”±çš„é‚£ä¸€åˆ»ï¼Œå¥¹è·ªåœ¨ä½ é¢å‰ï¼š"å¦‚çƒŸæ­¤ç”Ÿåšç‰›åšé©¬ï¼Œä¹Ÿè¦æŠ¥ç­”å…¬å­ã€‚"ä½ æ‰¶èµ·å¥¹ï¼š"æˆ‘ä¸æ˜¯è¦ä½ æŠ¥ç­”ï¼Œæˆ‘æ˜¯è¦ä½ åšæˆ‘çš„å¦»å­ã€‚"å¥¹éœ‡æƒŠåœ°çœ‹ç€ä½ ï¼Œçœ¼ä¸­æ»¡ä¸æ•¢ç›¸ä¿¡ã€‚

ã€ç¬¬åç« ï¼šæºæ‰‹å¤©æ¶¯ã€‘
ä½ ä»¬åœ¨æ‰¬å·žä¸¾è¡Œäº†ç®€å•çš„å©šç¤¼ã€‚æ²¡æœ‰ç››å¤§çš„ä»ªå¼ï¼Œæ²¡æœ‰è¾¾å®˜æ˜¾è´µçš„ç¥è´ºï¼Œåªæœ‰å½¼æ­¤çš„çœŸå¿ƒã€‚å©šåŽï¼Œä½ ä»¬å†³å®šæµªè¿¹å¤©æ¶¯ï¼Œè¿œç¦»ä¸–ä¿—çš„çº·æ‰°ã€‚ä½ ä»¬æ¸¸åŽ†åå±±å¤§å·ï¼Œçœ‹éä¸–é—´ç¾Žæ™¯ã€‚æ¯åˆ°ä¸€å¤„ï¼Œä½ éƒ½ä¼šä¸ºå¥¹å†™è¯—ï¼Œå¥¹ä¼šä¸ºä½ æŠšç´ã€‚è™½ç„¶ç”Ÿæ´»æ¸…è´«ï¼Œä½†ä½ ä»¬å´æ„Ÿåˆ°å‰æ‰€æœªæœ‰çš„å¹¸ç¦ã€‚æŸå¤œï¼Œåœ¨è¥¿æ¹–è¾¹ï¼Œå¥¹é åœ¨ä½ æ€€é‡Œï¼š"å¦‚çƒŸä»Žæœªæƒ³è¿‡ï¼Œè¿˜èƒ½æœ‰è¿™æ ·çš„ç”Ÿæ´»ã€‚"ä½ è½»å»å¥¹çš„é¢å¤´ï¼š"æœ‰ä½ çš„åœ°æ–¹ï¼Œå°±æ˜¯å®¶ã€‚"

ã€ç»ˆç« ï¼šç™½å¤´å•è€ã€‘
å¤šå¹´åŽï¼Œä½ ä»¬åœ¨æ±Ÿå—å°é•‡å®šå±…ã€‚ä½ å¼€äº†ä¸€å®¶ç§å¡¾ï¼Œæ•™å­©å­ä»¬è¯»ä¹¦å†™å­—ï¼›å¥¹åˆ™å¼€äº†é—´ç»£åŠï¼Œæ•™å¥³å­©å­ä»¬åˆºç»£ã€‚è™½ç„¶ç”Ÿæ´»å¹³æ·¡ï¼Œä½†ä½ ä»¬ç›¸æ¿¡ä»¥æ²«ï¼Œç™½å¤´å•è€ã€‚æ¯å½“å¤•é˜³è¥¿ä¸‹ï¼Œä½ ä»¬éƒ½ä¼šååœ¨é™¢å­é‡Œï¼Œå›žå¿†å½“å¹´åœ¨é†‰æœˆæ¥¼çš„åˆé‡ã€‚å¥¹æ€»æ˜¯ç¬‘ç€è¯´ï¼š"é‚£æ—¶å€™å¦‚çƒŸçœŸå‚»ï¼Œå·®ç‚¹å°±é”™è¿‡äº†ä½ ã€‚"ä½ å›žç­”ï¼š"æˆ‘ä¹Ÿå‚»ï¼Œå·®ç‚¹å°±å¤±åŽ»äº†ä½ ã€‚"ç„¶åŽç›¸è§†è€Œç¬‘ã€‚å²æœˆæµè½¬ï¼Œä½†ä½ ä»¬çš„çˆ±æƒ…å´å¦‚åŒé™ˆå¹´çš„ç¾Žé…’ï¼Œè¶Šé…¿è¶Šé¦™ã€‚

ï¼ˆæ€»è®¡çº¦5000å­—ï¼ŒåŒ…å«10ä¸ªç« èŠ‚ï¼Œè¯¦ç»†æè¿°äº†ä»ŽèŠ±æ¥¼åˆé‡åˆ°ç™½å¤´å•è€çš„å…¨è¿‡ç¨‹ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æœ‰ä¸°å¯Œçš„æƒ…æ„Ÿæå†™å’Œå¤é£Žç»†èŠ‚ï¼Œä¸ºAIç”Ÿæˆæä¾›äº†å……è¶³çš„åˆ›ä½œç´ æã€‚ï¼‰`,
  character: {
    name: 'æŸ³å¦‚çƒŸ',
    personality: 'æ‰æƒ…ç»è‰³ã€çœ‹é€ä¸–æƒ…å´ä»æ€€å¸Œæœ›ã€å¤–æŸ”å†…åˆšã€æ¸´æœ›ä¸€ä»½çœŸå¿ƒç›¸å¾…',
    appearance: 'ä¹Œå‘äº‘é¬“æ–œæ’çŽ‰ç°ªã€æŸ³çœ‰æçœ¼å«æƒ…è„‰è„‰ã€ç»›çº¢ç½—è£™æ›³åœ°ã€æ‰‹æ‰§ç»£èŠ±å›¢æ‰‡',
    relationship: 'äº¬åŸŽé†‰æœˆæ¥¼ç¬¬ä¸€èŠ±é­ï¼Œæ‰è‰ºåŒç»ååŠ¨äº¬åŸŽï¼Œä½ æ˜¯èµ´äº¬èµ¶è€ƒçš„è½é­„ä¹¦ç”Ÿ'
  },
  setting: 'ä¸­å›½å¤ä»£ç¹åŽäº¬åŸŽï¼ŒçƒŸæŸ³ç”»æ¡¥é£Žå¸˜ç¿ å¹•',
  createdAt: Date.now(),
  updatedAt: Date.now()
};

// é»˜è®¤å‰§æœ¬ï¼ˆä¿æŒå…¼å®¹ï¼‰
const DEFAULT_TEMPLATE: ScriptTemplate = PRESET_TSUNDERE;

// æ‰€æœ‰é¢„è®¾å‰§æœ¬
const ALL_PRESET_SCRIPTS: ScriptTemplate[] = [
  PRESET_TSUNDERE,
  PRESET_PRINCESS,
  PRESET_COURTESAN
];

// æ£€æŸ¥æ˜¯å¦ä¸ºé¢„è®¾å‰§æœ¬ï¼ˆä¸å¯åˆ é™¤ï¼‰
export const isPresetScript = (id: string): boolean => {
  return PRESET_SCRIPT_IDS.includes(id);
};

// èŽ·å–æ‰€æœ‰å‰§æœ¬
export const getAllScripts = (): ScriptTemplate[] => {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    let userScripts: ScriptTemplate[] = [];
    
    if (stored) {
      userScripts = JSON.parse(stored) as ScriptTemplate[];
      // è¿‡æ»¤æŽ‰æ—§çš„é¢„è®¾å‰§æœ¬ï¼ˆä¼šç”¨æœ€æ–°çš„æ›¿æ¢ï¼‰
      userScripts = userScripts.filter(s => !isPresetScript(s.id));
    }
    
    // é¢„è®¾å‰§æœ¬åœ¨å‰ï¼Œç”¨æˆ·å‰§æœ¬åœ¨åŽ
    return [...ALL_PRESET_SCRIPTS, ...userScripts];
  } catch (e) {
    console.error('Failed to load scripts:', e);
  }
  return [...ALL_PRESET_SCRIPTS];
};

// èŽ·å–å•ä¸ªå‰§æœ¬
export const getScriptById = (id: string): ScriptTemplate | null => {
  const scripts = getAllScripts();
  return scripts.find(s => s.id === id) || null;
};

// ä¿å­˜å‰§æœ¬
export const saveScript = (script: ScriptTemplate): void => {
  const scripts = getAllScripts();
  const existingIndex = scripts.findIndex(s => s.id === script.id);
  
  if (existingIndex >= 0) {
    scripts[existingIndex] = { ...script, updatedAt: Date.now() };
  } else {
    scripts.push({ ...script, createdAt: Date.now(), updatedAt: Date.now() });
  }
  
  localStorage.setItem(STORAGE_KEY, JSON.stringify(scripts));
};

// åˆ é™¤å‰§æœ¬
export const deleteScript = (id: string): boolean => {
  // é¢„è®¾å‰§æœ¬ä¸å¯åˆ é™¤
  if (isPresetScript(id)) return false;
  
  const stored = localStorage.getItem(STORAGE_KEY);
  if (!stored) return false;
  
  const scripts = JSON.parse(stored) as ScriptTemplate[];
  const filtered = scripts.filter(s => s.id !== id);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(filtered));
  return true;
};

// åˆ›å»ºæ–°å‰§æœ¬
export const createScript = (
  name: string,
  character: CharacterConfig,
  plotFramework: string,
  setting: string,
  description: string = ''
): ScriptTemplate => {
  const newScript: ScriptTemplate = {
    id: `script_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
    name,
    description,
    plotFramework,
    character,
    setting,
    createdAt: Date.now(),
    updatedAt: Date.now()
  };
  
  saveScript(newScript);
  return newScript;
};

// ç”Ÿæˆå‰§æƒ…æ¡†æž¶çš„æç¤ºè¯
export const generatePlotFrameworkPrompt = (character: CharacterConfig, setting: string): string => {
  return `è¯·æ ¹æ®ä»¥ä¸‹è§’è‰²å’Œè®¾å®šï¼Œç”Ÿæˆä¸€ä¸ªæœ‰è¶£çš„å‰§æƒ…æ¡†æž¶ï¼š

è§’è‰²åç§°ï¼š${character.name}
è§’è‰²æ€§æ ¼ï¼š${character.personality}
è§’è‰²å¤–è²Œï¼š${character.appearance}
ä¸Žä¸»è§’å…³ç³»ï¼š${character.relationship}
æ•…äº‹èƒŒæ™¯ï¼š${setting}

è¯·ç”Ÿæˆä¸€ä¸ªåŒ…å«å¼€ç«¯ã€å‘å±•ã€é«˜æ½®ã€ç»“å±€çš„ç®€çŸ­å‰§æƒ…æ¡†æž¶ï¼ˆçº¦100å­—ï¼‰ã€‚`;
};

// å¯¼å‡ºå‰§æœ¬ä¸ºJSON
export const exportScript = (script: ScriptTemplate): string => {
  return JSON.stringify(script, null, 2);
};

// æ›´æ–°å‰§æœ¬
export const updateScript = (id: string, updates: Partial<ScriptTemplate>): ScriptTemplate | null => {
  const scripts = getAllScripts();
  const scriptIndex = scripts.findIndex(s => s.id === id);
  
  if (scriptIndex === -1) {
    console.error('Script not found:', id);
    return null;
  }
  
  const existingScript = scripts[scriptIndex];
  
  // é¢„è®¾å‰§æœ¬é™åˆ¶
  if (isPresetScript(id)) {
    // é¢„è®¾å‰§æœ¬åªèƒ½ä¿®æ”¹ï¼šname, description, plotFramework
    const allowedUpdates = {
      name: updates.name,
      description: updates.description,
      plotFramework: updates.plotFramework
    };
    
    // è¿‡æ»¤æŽ‰ undefined å€¼
    const filteredUpdates = Object.fromEntries(
      Object.entries(allowedUpdates).filter(([_, value]) => value !== undefined)
    );
    
    const updatedScript = {
      ...existingScript,
      ...filteredUpdates,
      updatedAt: Date.now()
    };
    
    scripts[scriptIndex] = updatedScript;
    saveScript(updatedScript);
    return updatedScript;
  } else {
    // è‡ªå®šä¹‰å‰§æœ¬å¯ä»¥ä¿®æ”¹æ‰€æœ‰å­—æ®µï¼ˆé™¤äº† idï¼‰
    const { id: _, ...allowedUpdates } = updates;
    
    const updatedScript = {
      ...existingScript,
      ...allowedUpdates,
      updatedAt: Date.now()
    };
    
    scripts[scriptIndex] = updatedScript;
    saveScript(updatedScript);
    return updatedScript;
  }
};

// ä»ŽJSONå¯¼å…¥å‰§æœ¬
export const importScript = (jsonString: string): ScriptTemplate | null => {
  try {
    const script = JSON.parse(jsonString) as ScriptTemplate;
    if (script.name && script.character && script.plotFramework) {
      script.id = `imported_${Date.now()}`;
      saveScript(script);
      return script;
    }
  } catch (e) {
    console.error('Failed to import script:', e);
  }
  return null;
};
